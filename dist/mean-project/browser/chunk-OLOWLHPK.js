import{a as _t,b as N,c as kt,d as xt}from"./chunk-A5SQA5E2.js";import{b as U}from"./chunk-ZZBX7JAL.js";import{a as gt,b as ut,d as ht,e as Ct}from"./chunk-54YOY2DV.js";import{a as wt}from"./chunk-UXJZGTZ5.js";import{h as lt,i as ct,j as pt,k as mt,p as dt,q as ft}from"./chunk-CWIWXQ3X.js";import{Da as at,Fa as ot,La as st,Pa as rt,Y as Z,a as O,b as P,oa as $,pa as tt,qa as et,wa as A,xa as it,ya as nt}from"./chunk-46H3OTOU.js";import{$a as k,Cc as Y,Dc as D,Eb as c,Fb as x,Gb as q,Hb as G,Ib as u,Jb as h,Kb as C,Ma as l,Mb as L,Na as y,Nb as J,P as M,U as v,Wb as K,Yb as Q,Z as E,cb as d,fb as z,ga as f,ha as _,hb as I,lb as a,mb as n,na as B,nb as R,rb as F,sb as g,tb as m,zc as X}from"./chunk-HCFYYDRK.js";var S=class{constructor(o={}){this.id="",this.name="",Object.assign(this,o)}};var b=class{constructor(o={}){this.id="",this.duration=0,this.price=0,Object.assign(this,o),this.prestation=o.prestation?new U(o.prestation):new U,this.brand=o.brand?new S(o.brand):new S}};var j=class{constructor(o={}){this.id="",this.esimatedDuration=0,this.dateStart=new Date,Object.assign(this,o),this.user=o.user?new w(o.user):new w,this.prestationBrand=o.prestationBrand?new b(o.prestationBrand):new b,this.state=o.state?new N(o.state):new N}};var T=class{constructor(o={}){this.id="",this.name="",Object.assign(this,o)}};var W=class{constructor(o={}){this._id="",this.name="",this.firstName="",this.email="",this.password="",this.contact="",this.profile=new T,Object.assign(this,o),this.profile=o.profile?new T(o.profile):new T}};var w=class extends W{constructor(o={}){super(o),this.tasks=[],this.tasks=o.tasks?o.tasks.map(t=>new j(t)):[]}};var yt=(()=>{class e{constructor(t){this.http=t,this.apiUrl=`${A.apiUrl}/api/users`}getAllMecaniciens(){return this.http.get(`${this.apiUrl}/M\xE9canicien/`)}static{this.\u0275fac=function(s){return new(s||e)(v(P))}}static{this.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var V=(()=>{class e{constructor(t){this.http=t,this.apiUrl=`${A.apiUrl}/api/tasks`}getAllTasks(t,s,i){let r=new O;return r=r.set("page",t),r=r.set("size",s),Object.keys(i).forEach(p=>{i[p]&&(r=r.set(p,i[p]))}),this.http.get(`${this.apiUrl}/`,{params:r})}getNonAffectedTasks(t,s){let i=new O;return i=i.set("page",t),i=i.set("size",s),this.http.get(`${this.apiUrl}/non-affected`,{params:i})}affect(t,s){return this.http.put(`${this.apiUrl}/affect/`,{taskId:t,userId:s})}static{this.\u0275fac=function(s){return new(s||e)(v(P))}}static{this.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var vt=()=>({width:"25rem"});function Et(e,o){if(e&1){let t=F();a(0,"div",13)(1,"p-floatlabel",14)(2,"p-select",15),C("ngModelChange",function(i){f(t);let r=m(2);return h(r.filters.userId,i)||(r.filters.userId=i),_(i)}),n(),a(3,"label",16),c(4,"M\xE9canicien"),n()(),a(5,"p-floatlabel",14)(6,"p-datepicker",17),C("ngModelChange",function(i){f(t);let r=m(2);return h(r.filters.startDate,i)||(r.filters.startDate=i),_(i)}),n(),a(7,"label",18),c(8,"Date d\xE9but"),n()(),a(9,"p-floatlabel",14)(10,"p-datepicker",19),C("ngModelChange",function(i){f(t);let r=m(2);return h(r.filters.endDate,i)||(r.filters.endDate=i),_(i)}),n(),a(11,"label",20),c(12,"Date fin"),n()(),a(13,"p-floatlabel",14)(14,"p-select",21),C("ngModelChange",function(i){f(t);let r=m(2);return h(r.filters.state,i)||(r.filters.state=i),_(i)}),n(),a(15,"label",22),c(16,"\xC9tat"),n()(),a(17,"p-floatlabel",14)(18,"p-select",23),C("ngModelChange",function(i){f(t);let r=m(2);return h(r.filters.categoryId,i)||(r.filters.categoryId=i),_(i)}),n(),a(19,"label",24),c(20,"Cat\xE9gorie"),n()(),a(21,"button",25),g("click",function(){f(t);let i=m(2);return _(i.applyFilters())}),n()()}if(e&2){let t=m(2);l(2),d("options",t.mecaniciens),u("ngModel",t.filters.userId),l(4),u("ngModel",t.filters.startDate),l(4),u("ngModel",t.filters.endDate),l(4),u("ngModel",t.filters.state),l(4),d("options",t.categories),u("ngModel",t.filters.categoryId)}}function It(e,o){e&1&&k(0,Et,22,7,"ng-template",12)}function Lt(e,o){e&1&&(a(0,"th"),c(1,"Affectation"),n())}function Dt(e,o){e&1&&(a(0,"th"),c(1,"M\xE9canicien"),n(),a(2,"th"),c(3,"Etat"),n())}function Pt(e,o){if(e&1&&(a(0,"tr")(1,"th"),c(2,"Prestation"),n(),a(3,"th"),c(4,"Cat\xE9gorie"),n(),a(5,"th"),c(6,"Marque"),n(),a(7,"th"),c(8,"Date debut"),n(),a(9,"th"),c(10,"Dur\xE9e"),n(),k(11,Lt,2,0,"th")(12,Dt,4,0),n()),e&2){let t=m();l(11),I(t.affectation?11:12)}}function At(e,o){if(e&1){let t=F();a(0,"td")(1,"p-button",27),g("onClick",function(){f(t);let i=m(2).$implicit,r=m();return _(r.openDialog(i))}),n()()}e&2&&(l(),d("raised",!0))}function jt(e,o){if(e&1&&(a(0,"td"),c(1),n()),e&2){let t=m(3).$implicit;l(),G("",t.user.name," ",t.user.first_name,"")}}function Wt(e,o){e&1&&(a(0,"td"),c(1,"Aucun"),n())}function Vt(e,o){if(e&1&&(a(0,"td"),c(1),n()),e&2){let t=m(3).$implicit;l(),x(t.state.name)}}function Bt(e,o){e&1&&(a(0,"td"),c(1,"Non affect\xE9e"),n())}function Ft(e,o){if(e&1&&k(0,jt,2,2,"td",1)(1,Wt,2,0,"td",1)(2,Vt,2,1,"td",1)(3,Bt,2,0,"td",1),e&2){let t=m(2).$implicit;d("ngIf",t.user),l(),d("ngIf",!t.user),l(),d("ngIf",t.user),l(),d("ngIf",!t.user)}}function Ot(e,o){if(e&1&&(a(0,"tr")(1,"td"),c(2),n(),a(3,"td"),c(4),n(),a(5,"td"),c(6),n(),a(7,"td"),c(8),K(9,"date"),n(),a(10,"td"),c(11),n(),k(12,At,2,1,"td")(13,Ft,4,4),n()),e&2){let t=m().$implicit,s=m();l(2),x(t.prestation_brand.prestation.name),l(2),x(t.prestation_brand.prestation.category.name),l(2),x(t.prestation_brand.brand.name),l(2),x(Q(9,6,t.date_start,"d MMMM yyyy HH:mm")),l(3),q("",t.prestation_brand.duration," minutes"),l(),I(s.affectation&&!t.user?12:s.affectation?-1:13)}}function Ut(e,o){e&1&&(a(0,"tr",26),R(1,"app-message-block"),n()),e&2&&d("ariaColSpan",6)}function Nt(e,o){if(e&1&&k(0,Ot,14,9,"tr")(1,Ut,2,1,"tr",26),e&2){let t=m();I(t.tasks.length>0?0:1)}}var St=(()=>{class e{constructor(t,s,i){this.userService=t,this.taskService=s,this.categoryService=i,this.titre="T\xE2ches",this.rows=10,this.tasks=[],this.affectation=!1,this.paginationChange=new B,this.filtersChanged=new B,this.showAffectationDialog=!1,this.mecaniciens=[],this.categories=[],this.selectedMecanicien=new w,this.filters={userId:null,startDate:null,endDate:null,state:null,categoryId:null},this.first=0}ngOnInit(){this.userService.getAllMecaniciens().subscribe(t=>{this.mecaniciens=t}),this.categoryService.getCategories().subscribe(t=>{this.categories=t})}confirmAffectation(t){this.confirmationService.confirm({target:t.target,message:"Affecter ce(tte) m\xE9canicien(ne) \xE0 cette t\xE2che ?",header:"Confirmation",closable:!0,closeOnEscape:!0,icon:"pi pi-info-circle",rejectButtonProps:{label:"Annuler",severity:"secondary",outlined:!0},acceptButtonProps:{label:"Valider"},accept:()=>{this.selectedTask&&this.affectTask()},reject:()=>{}}),this.showAffectationDialog=!1}affectTask(){this.taskService.affect(this.selectedTask._id,this.selectedMecanicien._id).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"La t\xE2che a \xE9t\xE9 affect\xE9e avec succ\xE8s",life:3e3})},error:t=>{this.messageService.add({severity:"error",summary:"Erreur",detail:t.message,life:3e3})}})}openDialog(t){this.showAffectationDialog=!0,this.selectedTask=t}closeDialog(){this.showAffectationDialog=!1,this.selectedTask=void 0}onChildPageChange(t){this.paginationChange.emit(t)}applyFilters(){this.filtersChanged.emit(this.filters)}static{this.\u0275fac=function(s){return new(s||e)(y(yt),y(V),y(wt))}}static{this.\u0275cmp=E({type:e,selectors:[["app-task-list"]],inputs:{titre:"titre",rows:"rows",tasks:"tasks",affectation:"affectation",messageService:"messageService",confirmationService:"confirmationService"},outputs:{paginationChange:"paginationChange",filtersChanged:"filtersChanged"},standalone:!0,features:[L],decls:15,vars:12,consts:[[3,"value"],[4,"ngIf"],["pTemplate","header"],["pTemplate","body"],[3,"pageChange","totalRecords","rows"],["header","Affectation M\xE9canicien","closable","false",3,"visibleChange","modal","visible"],[1,"p-text-secondary","block","mb-3"],[1,"flex","items-center","gap-4","mb-4"],["optionLabel","first_name","placeholder","Selectionner Un M\xE9canicien","appendTo","body",1,"w-full","md:w-56",3,"ngModelChange","options","ngModel"],[1,"flex","justify-end","gap-2"],["label","Annuler","severity","secondary",3,"click"],["label","Affecter",3,"click"],["pTemplate","caption"],[1,"flex","gap-3"],["variant","on",1,"w-full"],["inputId","Mecanicien","optionLabel","name","optionValue","_id","styleClass","w-full",3,"ngModelChange","options","ngModel"],["for","Mecanicien"],["inputId","debut","showIcon","","iconDisplay","input","dateFormat","yy-mm-dd",3,"ngModelChange","ngModel"],["for","debut"],["inputId","fin","showIcon","","iconDisplay","input","dateFormat","yy-mm-dd",3,"ngModelChange","ngModel"],["for","fin"],["inputId","Etat","optionLabel","name","optionValue","_id","styleClass","w-full",3,"ngModelChange","ngModel"],["for","Etat"],["inputId","Category","optionLabel","name","optionValue","_id","styleClass","w-full",3,"ngModelChange","options","ngModel"],["for","Category"],["pButton","","label","Ok",3,"click"],[3,"ariaColSpan"],["label","Affecter","size","small",3,"onClick","raised"]],template:function(s,i){s&1&&(a(0,"h2"),c(1),n(),a(2,"p-table",0),k(3,It,1,0,null,1)(4,Pt,13,1,"ng-template",2)(5,Nt,2,1,"ng-template",3),n(),a(6,"app-pagination",4),g("pageChange",function(p){return i.onChildPageChange(p)}),n(),a(7,"p-dialog",5),C("visibleChange",function(p){return h(i.showAffectationDialog,p)||(i.showAffectationDialog=p),p}),a(8,"span",6),c(9,"Affecter un m\xE9canicien."),n(),a(10,"div",7)(11,"p-select",8),C("ngModelChange",function(p){return h(i.selectedMecanicien,p)||(i.selectedMecanicien=p),p}),n()(),a(12,"div",9)(13,"p-button",10),g("click",function(){return i.closeDialog()}),n(),a(14,"p-button",11),g("click",function(p){return i.confirmAffectation(p)}),n()()()),s&2&&(l(),x(i.titre),l(),d("value",i.tasks),l(),d("ngIf",!i.affectation),l(3),d("totalRecords",i.tasks.length)("rows",i.rows),l(),z(J(11,vt)),d("modal",!0),u("visible",i.showAffectationDialog),l(4),d("options",i.mecaniciens),u("ngModel",i.selectedMecanicien))},dependencies:[D,X,Y,ft,dt,Z,_t,et,$,tt,ht,ut,gt,mt,pt,st,at,ot,Ct,lt,rt,ct,kt,xt],encapsulation:2})}}return e})();var Be=(()=>{class e{constructor(t){this.taskService=t,this.tasks=[],this.first=0,this.rows=10,this.filters={}}ngOnInit(){this.getTasks()}getTasks(){this.taskService.getAllTasks(this.first,this.rows,this.filters).subscribe({next:t=>{this.tasks=t},error:t=>{console.error("Error getting tasks:",t)}})}onPaginationChange(t){this.first=t.first,this.rows=t.rows,console.log("Pagination mise \xE0 jour:",this.first,this.rows),this.getTasks()}onFiltersChanged(t){this.filters=t,console.log("Filtre mise \xE0 jour:",this.filters),this.first=0,this.getTasks()}static{this.\u0275fac=function(s){return new(s||e)(y(V))}}static{this.\u0275cmp=E({type:e,selectors:[["app-task-list-page"]],standalone:!0,features:[L],decls:2,vars:2,consts:[[3,"filtersChanged","paginationChange","titre","tasks"]],template:function(s,i){s&1&&(a(0,"p-card")(1,"app-task-list",0),g("filtersChanged",function(p){return i.onFiltersChanged(p)})("paginationChange",function(p){return i.onPaginationChange(p)}),n()()),s&2&&(l(),d("titre","Suivie des t\xE2ches")("tasks",i.tasks))},dependencies:[D,nt,it,St],encapsulation:2})}}return e})();export{V as a,St as b,Be as c};
