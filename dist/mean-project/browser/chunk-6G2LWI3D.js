import{f as c}from"./chunk-DGH3L4YA.js";import{b as l,wa as p}from"./chunk-46H3OTOU.js";import{P as i,U as r,k as s}from"./chunk-HCFYYDRK.js";var f=(()=>{class o{constructor(t){this.http=t,this.tokenKey="access_token",this.isLoggedIn$=new s(this.hasToken()),this.apiUrl=`${p.apiUrl}`}login(t,e){return this.http.post(`${this.apiUrl}/auth/login`,{email:t,password:e})}saveToken(t){localStorage.setItem(this.tokenKey,t),this.isLoggedIn$.next(!0)}getToken(){return localStorage.getItem(this.tokenKey)}getUserInfo(){let t=this.getToken();return t?JSON.parse(atob(t.split(".")[1])):null}isLoggedRight(t){let e=this.getUserInfo();return e==null||e.profile==null?!1:e.profile==t}logout(){localStorage.removeItem(this.tokenKey),this.isLoggedIn$.next(!1)}hasToken(){return!!localStorage.getItem(this.tokenKey)}static{this.\u0275fac=function(e){return new(e||o)(r(l))}}static{this.\u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var y=(()=>{class o{constructor(t,e){this.auth=t,this.router=e}canActivate(t){let e=this.auth.getToken();if(!e){console.log("TOKEN non present, redirection vers login");let u=t.data.profile.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return this.router.navigate(["/"+u+"/login"]),!1}let n=t.data.profile,a=JSON.parse(atob(e.split(".")[1]));return n&&a.profile!==n?(console.log(`Profil autoris\xE9(s): ${n}. Votre profil : ${a.profile} `),this.router.navigate(["/unauthorized"]),!1):!0}static{this.\u0275fac=function(e){return new(e||o)(r(f),r(c))}}static{this.\u0275prov=i({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{f as a,y as b};
